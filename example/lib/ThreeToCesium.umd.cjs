(function(r,s){typeof exports=="object"&&typeof module!="undefined"?module.exports=s(require("three")):typeof define=="function"&&define.amd?define(["three"],s):(r=typeof globalThis!="undefined"?globalThis:r||self,r.ThreeToCesium=s(r.THREE))})(this,function(r){"use strict";var C=r=>{throw TypeError(r)};var c=(r,s,n)=>s.has(r)||C("Cannot "+n);var l=(r,s,n)=>(c(r,s,"read from private field"),n?n.call(r):s.get(r)),f=(r,s,n)=>s.has(r)?C("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,n),w=(r,s,n,u)=>(c(r,s,"write to private field"),u?u.call(r,n):s.set(r,n),n),p=(r,s,n)=>(c(r,s,"access private method"),n);var m,d,y,R;function s(a){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const t in a)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(a,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>a[t]})}}return e.default=a,Object.freeze(e)}const n=s(r);class u{constructor(e,t={}){f(this,d);f(this,m);var i,h;this.cesiumViewer=e,w(this,m,{near:(i=t.near)!=null?i:.1,far:(h=t.far)!=null?h:1e4}),p(this,d,y).call(this)}add(e,t){let i=Cesium.Transforms.eastNorthUpToFixedFrame(t),h=new n.Matrix4;h.set(i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],0,0,0,1),h.multiply(new n.Matrix4().makeRotationX(Math.PI/2));let o=new n.Group;return this.threeScene.add(o),o.add(e),o.applyMatrix4(h),o}remove(e){this.threeScene.remove(e.parent),this.threeScene.remove(e)}update(){this._isDestory||(p(this,d,R).call(this),this.threeRenderer.render(this.threeScene,this.threeCamera))}destory(){this._isDestory=!0,this.threeRenderer.dispose(),this.cesiumViewer.container.removeChild(this.threeRenderer.domElement)}}m=new WeakMap,d=new WeakSet,y=function(){let e=this.cesiumViewer.container,t=e.offsetWidth,i=e.offsetHeight;this.threeScene=new n.Scene,this.threeCamera=new n.PerspectiveCamera(void 0,t/i,l(this,m).near,l(this,m).far),this.threeRenderer=new n.WebGLRenderer({alpha:!0}),this.threeRenderer.setClearColor(0,0),this.threeRenderer.domElement.style.position="absolute",this.threeRenderer.domElement.style.top="0",this.threeRenderer.domElement.style.width="100%",this.threeRenderer.domElement.style.height="100%",this.threeRenderer.domElement.style.pointerEvents="none",e.appendChild(this.threeRenderer.domElement)},R=function(){this.threeCamera.matrixAutoUpdate=!1,this.threeCamera.fov=Cesium.Math.toDegrees(this.cesiumViewer.camera.frustum.fovy);let e=this.cesiumViewer.camera.viewMatrix,t=this.cesiumViewer.camera.inverseViewMatrix;this.threeCamera.matrixWorld.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this.threeCamera.matrixWorldInverse.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);let i=this.cesiumViewer.container,h=i.offsetWidth,o=i.offsetHeight,v=h/o;this.threeCamera.aspect=v,this.threeCamera.updateProjectionMatrix(),this.threeRenderer.setSize(h,o)};function x(...a){return new u(...a)}return x});
