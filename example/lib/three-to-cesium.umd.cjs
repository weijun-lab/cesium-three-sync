(function(r,s){typeof exports=="object"&&typeof module!="undefined"?module.exports=s(require("three"),require("cesium")):typeof define=="function"&&define.amd?define(["three","cesium"],s):(r=typeof globalThis!="undefined"?globalThis:r||self,r.ThreeToCesium=s(r.THREE,r.Cesium))})(this,function(r,s){"use strict";var y=r=>{throw TypeError(r)};var p=(r,s,n)=>s.has(r)||y("Cannot "+n);var l=(r,s,n)=>(p(r,s,"read from private field"),n?n.call(r):s.get(r)),f=(r,s,n)=>s.has(r)?y("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,n),C=(r,s,n,a)=>(p(r,s,"write to private field"),a?a.call(r,n):s.set(r,n),n),w=(r,s,n)=>(p(r,s,"access private method"),n);var d,u,c,x,v;function n(o){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const t in o)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>o[t]})}}return e.default=o,Object.freeze(e)}const a=n(r),R=n(s);class T{constructor(e,t={}){f(this,c);f(this,d);f(this,u);var i,h;this.cesiumViewer=e,C(this,d,{cameraNear:(i=t.cameraNear)!=null?i:.1,cameraFar:(h=t.cameraFar)!=null?h:1e4}),w(this,c,x).call(this)}add(e,t){let i=R.Transforms.eastNorthUpToFixedFrame(t),h=new a.Matrix4;h.set(i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],0,0,0,1),h.multiply(new a.Matrix4().makeRotationX(Math.PI/2));let m=new a.Group;return this.threeScene.add(m),m.add(e),m.applyMatrix4(h),m}remove(e){this.threeScene.remove(e.parent),this.threeScene.remove(e)}update(){l(this,u)||(w(this,c,v).call(this),this.threeRenderer.render(this.threeScene,this.threeCamera))}destroy(){C(this,u,!0),this.threeRenderer.dispose(),this.cesiumViewer.container.removeChild(this.threeRenderer.domElement)}}d=new WeakMap,u=new WeakMap,c=new WeakSet,x=function(){let e=this.cesiumViewer.container,t=e.offsetWidth,i=e.offsetHeight;this.threeScene=new a.Scene,this.threeCamera=new a.PerspectiveCamera(void 0,t/i,l(this,d).cameraNear,l(this,d).cameraFar),this.threeRenderer=new a.WebGLRenderer({alpha:!0}),this.threeRenderer.setClearColor(0,0),this.threeRenderer.domElement.style.position="absolute",this.threeRenderer.domElement.style.top="0",this.threeRenderer.domElement.style.width="100%",this.threeRenderer.domElement.style.height="100%",this.threeRenderer.domElement.style.pointerEvents="none",e.appendChild(this.threeRenderer.domElement)},v=function(){this.threeCamera.matrixAutoUpdate=!1,this.threeCamera.fov=R.Math.toDegrees(this.cesiumViewer.camera.frustum.fovy);let e=this.cesiumViewer.camera.viewMatrix,t=this.cesiumViewer.camera.inverseViewMatrix;this.threeCamera.matrixWorld.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this.threeCamera.matrixWorldInverse.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);let i=this.cesiumViewer.container,h=i.offsetWidth,m=i.offsetHeight,M=h/m;this.threeCamera.aspect=M,this.threeCamera.updateProjectionMatrix(),this.threeRenderer.setSize(h,m)};function E(...o){return new T(...o)}return E});
